{% load static %}
<head>
    <title>My Feedback</title>
    <link rel="stylesheet" href="{% static 'pos_app/css/feedback.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<div class="container">
    <h2>My Feedback</h2>
    <ul>
        {% for f in feedbacks %}
            <li>
                <div class="feedback-content">
                    <strong><i class="fa-solid fa-star"></i> {{ f.rating }} Stars</strong> 
                    â€” {{ f.comment|truncatechars:70 }}
                </div>
                <div class="actions">
                    <a href="{% url 'edit_feedback' f.id %}" class="btn-secondary" style="margin: 0;">
                        <i class="fa-solid fa-pen"></i> Edit
                    </a>
                    <button class="deleteBtn" data-id="{{ f.id }}">
                        <i class="fa-solid fa-trash-can"></i> Delete
                    </button>
                </div>
            </li>
        {% empty %}
            <li style="text-align: center; color: var(--text-color-muted); padding: 40px;">No feedback submitted yet.</li>
        {% endfor %}
    </ul>
    
    <div style="margin-top: 30px;">
        <a href="{% url 'profile' %}" class="btn-secondary">Back to Profile</a>
    </div>
</div>

<div id="deleteModal">
    <div class="modal-content">
        <p>Are you sure you want to delete this feedback?</p>
        <form id="deleteForm" method="post">
            {% csrf_token %}
            <button type="submit" class="btn-primary">Yes, Delete</button>
            <button type="button" id="cancelDelete" class="btn-secondary">Cancel</button>
        </form>
    </div>
</div>

<script>
    const modal = document.getElementById('deleteModal');
    const deleteForm = document.getElementById('deleteForm');
    const cancelBtn = document.getElementById('cancelDelete');

    document.querySelectorAll('.deleteBtn').forEach(btn => {
        btn.addEventListener('click', function() {
            const feedbackId = this.dataset.id;
            // Ensure the dynamic URL is correctly configured in your Django project
            deleteForm.action = `/feedback/delete/${feedbackId}/`; 
            modal.style.display = 'flex'; // Display modal using flex for centering
        });
    });

    cancelBtn.addEventListener('click', function() {
        modal.style.display = 'none';
    });
</script>