{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Request</title>
  <link rel="stylesheet" href="{% static 'pos_app/css/add_requestStyle.css' %}">
  <link rel="stylesheet" href="{% static 'pos_app/css/theme.css' %}">
  <script src="{% static 'pos_app/js/theme-cookie.js' %}" defer></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<header>
    <div class="logo">EduAssist</div>
    <nav>
      {% if user.is_staff %}
          <a href="{% url 'dashboard' %}">All Requests</a>
          <a href="{% url 'admin_dashboard' %}">Admin Panel</a>
          <a href="{% url 'create_category' %}">Create Category</a>
      {% else %}
          <a href="{% url 'dashboard' %}">My Requests</a>
          <a href="{% url 'add_request' %}">New Request</a>
      {% endif %}

      
      <a href="{% url 'logout' %}">Logout</a>
  </nav>
    <nav>
    <a class="user-icon" href="{% url 'profile' %}">Profile</a>
    <a href="{% url 'settings' %}">
        <i class="fa-solid fa-gear"></i> Settings
      </a>
      </nav>
  </header>

<main>
  <div class="card">
    <h1>Create Request</h1>
    <p class="subtitle">Fill in the details below to submit a new request</p>

    <form method="POST" enctype="multipart/form-data" class="request-form">
      {% csrf_token %}

      <div class="form-group">
        <label>Title</label>
        <input type="text" name="title" required>
      </div>

      <div class="form-group">
        <label>Description</label>
        <textarea name="description" required></textarea>
      </div>

      <div class="form-group">
        <label>Priority</label>
        <select name="priority">
            <option value="low">Low</option>
            <option value="medium" selected>Medium</option>
            <option value="high">High</option>
            <option value="critical">Critical</option>
        </select>
      </div>

      <div class="form-group">
        <label>Category</label>
        <select name="category" id="category" required>
          <option value="">Select Category</option>
          {% for cat in categories %}
            <option value="{{ cat.id }}">{{ cat.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label>Query Type</label>
          
        <select name="category_choice" id="category_choice" required>
          <option value="">Select Query Type</option>
          {% for choice in category_choices %}
            <option value="{{ choice.id }}" data-category="{{ choice.category.id }}">
              {{ choice.value }} ({{ choice.category.name }})
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label>Tags (comma separated)</label>
        <input type="text" name="tags" placeholder="urgent, bug, finance">
      </div>

      <div class="form-group">
        <label>Attachment</label>
        <input type="file" name="attachment">
      </div>

      <div class="btn-group">
        <button type="submit" class="button save">Submit Request</button>
        <a href="{% url 'dashboard' %}" class="button cancel">Cancel</a>
      </div>
    </form>
  </div>
</main>

<script>
  const categorySelect = document.getElementById('category');
  const choiceSelect = document.getElementById('category_choice');

  categorySelect.addEventListener('change', function() {
      const selectedCategory = this.value;
      for (const option of choiceSelect.options) {
          if (!option.value) continue;
          option.style.display = (option.dataset.category === selectedCategory) ? 'block' : 'none';
      }
      choiceSelect.value = '';
  });

  categorySelect.dispatchEvent(new Event('change'));
</script>

</body>
</html>
