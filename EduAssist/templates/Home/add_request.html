{% extends 'base.html' %}
{% load static %}

{% block title %}Create New Request{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'pos_app/css/add_requestStyle.css' %}">
{% endblock %}

{% block content %}
<main class="main-content-area">
    <div class="card add-request-card">
        <h1>Create Request</h1>
        <p class="subtitle">Fill in the details below to submit a new request</p>

        <form method="POST" enctype="multipart/form-data" class="request-form">
            {% csrf_token %}

            <div class="form-grid">

                <div class="form-group form-group-full">
                    <label for="id_title">Title</label>
                    <input type="text" id="id_title" name="title" required placeholder="A brief, descriptive summary of your request">
                </div>

                <div class="form-group">
                    <label for="id_priority">Priority</label>
                    <select id="id_priority" name="priority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="id_category">Category</label>
                    <select id="id_category" name="category" required>
                        <option value="">Select Category</option>
                        {% for cat in categories %}
                            <option value="{{ cat.id }}">{{ cat.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="id_query_type">Query Type</label>
                    <select name="category_choice" id="id_query_type" required>
                        <option value="">Select Query Type</option>
                        {% for choice in category_choices %}
                            <option value="{{ choice.id }}" data-category="{{ choice.category.id }}">
                                {{ choice.value }} ({{ choice.category.name }})
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="id_tags">Tags (comma separated)</label>
                    <input type="text" id="id_tags" name="tags" placeholder="urgent, bug, finance">
                </div>

                <div class="form-group form-group-full">
                    <label for="id_description">Description</label>
                    <textarea id="id_description" name="description" required rows="6" placeholder="Provide full details, steps, or required outcomes."></textarea>
                </div>

                <div class="form-group form-group-full file-upload-group">
                    <label for="id_attachment">Attachment (Optional)</label>
                    <input type="file" id="id_attachment" name="attachment">
                </div>

            </div>

            <div class="btn-group">
                <button type="submit" class="button button-save">Submit Request</button>
                <a href="{% url 'dashboard' %}" class="button button-cancel">Cancel</a>
            </div>
        </form>
    </div>
</main>
{% endblock content %}

{% block extra_js %}
<script>
    const categorySelect = document.getElementById('id_category');
    const choiceSelect = document.getElementById('id_query_type');

    categorySelect.addEventListener('change', function() {
        const selectedCategory = this.value;
        let foundMatch = false;

        for (const option of choiceSelect.options) {
            if (!option.value) continue;
            option.style.display = 'none';
        }

        for (const option of choiceSelect.options) {
            if (option.dataset.category === selectedCategory) {
                option.style.display = 'block';
                foundMatch = true;
            }
        }

        choiceSelect.value = '';
    });

    categorySelect.dispatchEvent(new Event('change'));
</script>
{% endblock %}
